(function(){"use strict";let l=[];const S="/arc-prototype/data/chants.json",C=async()=>(l.length||(l=await fetch(S).then(o=>o.json())),l),i=o=>o.trim().toLowerCase(),M=o=>o.replace(/\s+/g,"").toLowerCase(),j=(o,s)=>{const e=[];for(let n=o.indexOf(s);n!==-1;n=o.indexOf(s,n+1))e.push(n);return e},L=o=>{const s=[],e=[];let n=0;return o.syllables.forEach((t,a)=>{e[a]=n;for(let r=0;r<t.volpiano.length;r++)s[n+r]=a;n+=t.volpiano.length+2}),{ofs2Syl:s,syl2Start:e}},b=o=>{const s=o.syllables.map(t=>t.volpiano).join("--").toLowerCase(),e=[];let n="";for(let t=0,a=0;t<s.length;t++){if(s[t]==="-"&&s[t+1]==="-"){t++;continue}e[a++]=t,n+=s[t]}return{clean:n,map:e}};self.onmessage=async o=>{const{pattern:s,msFrom:e}=o.data;if(!s?.trim()||!e?.trim()){postMessage({hits:[],elapsedMs:0});return}const n=i(e),t=M(s),a=await C(),r=[],v=performance.now();for(const c of a){if(i(c.ms)!==n)continue;const{clean:x,map:p}=b(c),f=j(x,t);if(!f.length)continue;const{ofs2Syl:u,syl2Start:d}=L(c);for(const m of f){const A=m+t.length-1,h=p[m],g=p[A],w=u[h],y=u[g];r.push({ms:c.ms,uuid:c.uuid,start:w,end:y+1,startChar:h-d[w],endChar:g-d[y]})}}postMessage({hits:r,elapsedMs:Math.round(performance.now()-v)})}})();
