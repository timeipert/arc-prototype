(function(){"use strict";let l=[];const S=async()=>(l.length||(l=await fetch("/data/chants.json").then(s=>s.json())),l),i=s=>s.trim().toLowerCase(),C=s=>s.replace(/\s+/g,"").toLowerCase(),M=(s,o)=>{const e=[];for(let n=s.indexOf(o);n!==-1;n=s.indexOf(o,n+1))e.push(n);return e},j=s=>{const o=[],e=[];let n=0;return s.syllables.forEach((t,a)=>{e[a]=n;for(let r=0;r<t.volpiano.length;r++)o[n+r]=a;n+=t.volpiano.length+2}),{ofs2Syl:o,syl2Start:e}},b=s=>{const o=s.syllables.map(t=>t.volpiano).join("--").toLowerCase(),e=[];let n="";for(let t=0,a=0;t<o.length;t++){if(o[t]==="-"&&o[t+1]==="-"){t++;continue}e[a++]=t,n+=o[t]}return{clean:n,map:e}};self.onmessage=async s=>{const{pattern:o,msFrom:e}=s.data;if(!o?.trim()||!e?.trim()){postMessage({hits:[],elapsedMs:0});return}const n=i(e),t=C(o),a=await S(),r=[],v=performance.now();for(const c of a){if(i(c.ms)!==n)continue;const{clean:L,map:f}=b(c),p=M(L,t);if(!p.length)continue;const{ofs2Syl:u,syl2Start:d}=j(c);for(const m of p){const x=m+t.length-1,h=f[m],g=f[x],w=u[h],y=u[g];r.push({ms:c.ms,uuid:c.uuid,start:w,end:y+1,startChar:h-d[w],endChar:g-d[y]})}}postMessage({hits:r,elapsedMs:Math.round(performance.now()-v)})}})();
